{{define "admin_oauth_apps"}}
<div class="d-flex justify-content-between align-items-center mb-4">
  <div>
    <h2 class="h4 fw-bold mb-1">OAuth Apps</h2>
    <p class="text-muted small mb-0">外部客户端跳转到本网站登录并授权，成功后可用授权码换取 `rlm_...`。</p>
  </div>
  <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#createOAuthAppModal">
    <i class="ri-add-line me-1"></i> 新建应用
  </button>
</div>

{{if .Notice}}
<div class="alert alert-success alert-dismissible fade show mb-4" role="alert">
  <i class="ri-checkbox-circle-line me-2"></i>{{.Notice}}
  <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="关闭"></button>
</div>
{{end}}

{{if .Error}}
<div class="alert alert-danger alert-dismissible fade show mb-4" role="alert">
  <i class="ri-alert-line me-2"></i>{{.Error}}
  <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="关闭"></button>
</div>
{{end}}

<div class="card border-0 shadow-sm overflow-hidden">
  <table class="table align-middle mb-0">
    <thead>
      <tr>
        <th class="ps-4">名称</th>
        <th>Client ID</th>
        <th>状态</th>
        <th>回调地址</th>
        <th class="pe-4">操作</th>
      </tr>
    </thead>
    <tbody>
      {{range .OAuthApps}}
      <tr>
        <td class="ps-4 fw-semibold">{{.Name}}</td>
        <td><code class="user-select-all">{{.ClientID}}</code></td>
        <td>
          {{if eq .Status 1}}
            <span class="badge bg-success-subtle text-success-emphasis border">启用</span>
          {{else}}
            <span class="badge bg-secondary-subtle text-secondary-emphasis border">停用</span>
          {{end}}
        </td>
        <td>
          <span class="text-muted small">{{len .RedirectURIs}} 条</span>
        </td>
        <td class="pe-4">
          <a class="btn btn-sm btn-outline-secondary" href="/admin/oauth-apps/{{.ID}}">
            <i class="ri-settings-3-line me-1"></i> 管理
          </a>
        </td>
      </tr>
      {{end}}
      {{if not .OAuthApps}}
      <tr>
        <td colspan="5" class="text-center text-muted py-4">暂无 OAuth 应用</td>
      </tr>
      {{end}}
    </tbody>
  </table>
</div>

<!-- Create Modal -->
<div class="modal fade" id="createOAuthAppModal" tabindex="-1" aria-labelledby="createOAuthAppModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-scrollable">
    <div class="modal-content border-0 shadow">
      <div class="modal-header">
        <h5 class="modal-title" id="createOAuthAppModalLabel">新建 OAuth 应用</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="关闭"></button>
      </div>
      <div class="modal-body">
        <form method="POST" action="/admin/oauth-apps">
          <input type="hidden" name="_csrf" value="{{.CSRFToken}}">

          <label>应用名称</label>
          <input type="text" name="name" required placeholder="例如：My Chat Client">

          <label>状态</label>
          <select name="status">
            <option value="1" selected>启用</option>
            <option value="0">停用</option>
          </select>

          <label>回调地址白名单（redirect_uri，一行一个，精确匹配）</label>
          <textarea name="redirect_uris" rows="6" placeholder="https://example.com/oauth/callback&#10;http://localhost:3000/callback" required></textarea>

          <div class="d-flex justify-content-end gap-2">
            <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">取消</button>
            <button type="submit" class="btn btn-primary">创建</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
{{end}}

