{{define "admin_tickets"}}
<div class="d-flex justify-content-between align-items-center mb-4">
  <div>
    <h3 class="h4 fw-bold mb-0">工单管理</h3>
    <p class="text-muted small mb-0">处理用户的技术支持请求。</p>
  </div>
  <div class="card shadow-sm border-0 py-1 px-1">
    <div class="d-flex gap-1">
      <a class="btn btn-sm btn-white text-dark" href="/admin/tickets">全部</a>
      <a class="btn btn-sm btn-white text-dark" href="/admin/tickets?status=open">待处理</a>
      <a class="btn btn-sm btn-white text-dark" href="/admin/tickets?status=closed">已关闭</a>
    </div>
  </div>
</div>

{{if .Error}}
<div class="alert alert-danger shadow-sm mb-4">
  <i class="ri-alert-line me-2"></i>{{.Error}}
</div>
{{end}}
{{if .Notice}}
<div class="alert alert-success shadow-sm mb-4">
  <i class="ri-checkbox-circle-line me-2"></i>{{.Notice}}
</div>
{{end}}

<div class="card shadow-sm border-0 overflow-hidden">
  {{if not .Tickets}}
    <div class="text-center py-5 text-muted">
      <i class="ri-customer-service-2-line fs-1 d-block mb-3 opacity-50"></i>
      <p>暂无相关工单</p>
    </div>
  {{else}}
  <div class="table-responsive">
    <table class="table table-hover align-middle mb-0">
      <thead class="table-light">
        <tr>
          <th class="ps-4" style="width: 80px;">ID</th>
          <th style="width: 260px;">用户</th>
          <th>标题</th>
          <th style="width: 120px;">状态</th>
          <th style="width: 160px;">最后更新</th>
          <th style="width: 100px;"></th>
        </tr>
      </thead>
      <tbody>
        {{range .Tickets}}
        <tr>
          <td class="ps-4 text-muted font-monospace">#{{.ID}}</td>
          <td>
            <div class="d-flex align-items-center">
              <div class="bg-light rounded-circle p-1 me-2 text-primary d-flex align-items-center justify-content-center" style="width:24px;height:24px;">
                <i class="ri-user-line" style="font-size:14px;"></i>
              </div>
              <code class="text-dark bg-transparent p-0">{{.UserEmail}}</code>
            </div>
          </td>
          <td class="fw-medium text-dark">{{.Subject}}</td>
          <td><span class="badge rounded-pill {{.StatusBadge}}">{{.StatusText}}</span></td>
          <td class="text-muted small">{{.LastMessageAt}}</td>
          <td class="text-end pe-4">
            <a class="btn btn-sm btn-light border" href="/admin/tickets/{{.ID}}"><i class="ri-eye-line me-1"></i>查看</a>
          </td>
        </tr>
        {{end}}
      </tbody>
    </table>
  </div>
  {{end}}
</div>
{{end}}
