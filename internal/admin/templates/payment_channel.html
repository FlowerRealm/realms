{{define "admin_payment_channel"}}
<div class="d-flex justify-content-between align-items-center mb-4">
  <div>
    <div class="text-muted small mb-1">
      <a class="text-muted" href="/admin/settings"><i class="ri-arrow-left-line me-1"></i>系统设置</a>
      <span class="mx-1">/</span>
      <a class="text-muted" href="/admin/settings/payment-channels">支付渠道</a>
      <span class="mx-1">/</span>
      <span>配置</span>
    </div>
    <h2 class="h4 fw-bold mb-1">支付渠道配置</h2>
    <p class="text-muted small mb-0">渠道：<span class="fw-semibold text-dark">{{.PaymentChannel.Name}}</span>（{{.PaymentChannel.TypeLabel}}）</p>
  </div>
  <div>
    <a href="/admin/settings/payment-channels" class="btn btn-sm btn-outline-secondary"><i class="ri-arrow-left-line me-1"></i>返回列表</a>
  </div>
</div>

{{if .Notice}}
<div class="alert alert-success alert-dismissible fade show mb-4" role="alert">
  <i class="ri-checkbox-circle-line me-2"></i>{{.Notice}}
  <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="关闭"></button>
</div>
{{end}}

{{if .Error}}
<div class="alert alert-danger alert-dismissible fade show mb-4" role="alert">
  <i class="ri-alert-line me-2"></i>{{.Error}}
  <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="关闭"></button>
</div>
{{end}}

<div class="card border-0 shadow-sm">
  <div class="card-body">
    <h5 class="fw-semibold mb-3">基础信息</h5>
    <form method="POST" action="/admin/settings/payment-channels/{{.PaymentChannel.ID}}" data-ajax="1" data-ajax-reload="1">
      <input type="hidden" name="_csrf" value="{{.CSRFToken}}" />

      <div class="row g-3">
        <div class="col-md-6">
          <label class="form-label fw-medium">渠道名称</label>
          <input name="name" type="text" class="form-control" value="{{.PaymentChannel.Name}}" />
        </div>
        <div class="col-md-6">
          <label class="form-label fw-medium">类型</label>
          <input type="text" class="form-control" value="{{.PaymentChannel.TypeLabel}}" disabled />
        </div>
        <div class="col-12 d-flex align-items-end">
          <div class="form-check form-switch">
            <input class="form-check-input" type="checkbox" role="switch" id="paymentChannelStatus" name="enabled" value="1" {{if eq .PaymentChannel.Status 1}}checked{{end}}>
            <label class="form-check-label" for="paymentChannelStatus">启用</label>
          </div>
          <div class="ms-2">
            {{if .PaymentChannel.Usable}}
              <span class="badge bg-success bg-opacity-10 text-success">可用</span>
            {{else}}
              <span class="badge bg-warning bg-opacity-10 text-warning">待配置</span>
            {{end}}
          </div>
        </div>
      </div>

      <hr class="my-4">

      {{if eq .PaymentChannel.Type "stripe"}}
      <h5 class="fw-semibold mb-3">Stripe 配置</h5>
      <div class="row g-3">
        <div class="col-md-3">
          <label class="form-label fw-medium">currency</label>
          <input name="stripe_currency" type="text" class="form-control" value="{{.PaymentChannel.StripeCurrency}}" placeholder="cny" />
          <div class="form-text small text-muted">留空将使用默认值（cny）。</div>
        </div>

        <div class="col-md-6">
          <label class="form-label fw-medium">secret_key</label>
          <input name="stripe_secret_key" type="password" class="form-control" placeholder="留空表示保持不变" autocomplete="new-password" />
          <div class="form-text small text-muted">当前：{{if .PaymentChannel.StripeSecretKeySet}}已设置{{else}}未设置{{end}}。密钥不回显。</div>
        </div>

        <div class="col-md-6">
          <label class="form-label fw-medium">webhook_secret</label>
          <input name="stripe_webhook_secret" type="password" class="form-control" placeholder="留空表示保持不变" autocomplete="new-password" />
          <div class="form-text small text-muted">当前：{{if .PaymentChannel.StripeWebhookSecretSet}}已设置{{else}}未设置{{end}}。密钥不回显。</div>
        </div>
      </div>

      <div class="alert alert-info d-flex align-items-center mt-4" role="alert">
        <i class="ri-information-line me-2"></i>
        <div>
          Stripe Webhook URL：<code>{{.PaymentChannel.WebhookURL}}</code>
        </div>
      </div>
      {{end}}

      {{if eq .PaymentChannel.Type "epay"}}
      <h5 class="fw-semibold mb-3">EPay（易支付）配置</h5>
      <div class="row g-3">
        <div class="col-md-6">
          <label class="form-label fw-medium">gateway</label>
          <input name="epay_gateway" type="text" class="form-control" value="{{.PaymentChannel.EPayGateway}}" placeholder="https://epay.example.com" />
        </div>
        <div class="col-md-6">
          <label class="form-label fw-medium">partner_id</label>
          <input name="epay_partner_id" type="text" class="form-control" value="{{.PaymentChannel.EPayPartnerID}}" placeholder="10001" />
        </div>
        <div class="col-md-6">
          <label class="form-label fw-medium">key</label>
          <input name="epay_key" type="password" class="form-control" placeholder="留空表示保持不变" autocomplete="new-password" />
          <div class="form-text small text-muted">当前：{{if .PaymentChannel.EPayKeySet}}已设置{{else}}未设置{{end}}。密钥不回显。</div>
        </div>
      </div>

      <div class="alert alert-info d-flex align-items-center mt-4" role="alert">
        <i class="ri-information-line me-2"></i>
        <div>
          EPay Notify URL：<code>{{.PaymentChannel.WebhookURL}}</code>
        </div>
      </div>
      {{end}}

      <hr class="my-4">

      <div class="d-flex align-items-center justify-content-between">
        <button type="submit" class="btn btn-primary px-4">保存</button>
        <form method="POST" action="/admin/settings/payment-channels/{{.PaymentChannel.ID}}/delete" data-ajax="1" data-ajax-reload="1" class="d-inline">
          <input type="hidden" name="_csrf" value="{{.CSRFToken}}" />
          <button type="submit" class="btn btn-light border text-danger" onclick="return confirm('确认删除支付渠道 {{.PaymentChannel.Name}}? 此操作不可撤销。');"><i class="ri-delete-bin-line me-1"></i>删除</button>
        </form>
      </div>
    </form>
  </div>
</div>
{{end}}
