{{define "admin_orders"}}
<div class="d-flex justify-content-between align-items-center mb-4">
  <div>
    <h2 class="h4 fw-bold mb-0">订单</h2>
    <p class="text-muted small mb-0">订阅购买先创建订单；支付后自动生效；也可管理员手动批准生效。</p>
  </div>
</div>

{{if .Notice}}
<div class="alert alert-success mb-4">
  <i class="ri-checkbox-circle-line me-2"></i>{{.Notice}}
</div>
{{end}}

{{if .Error}}
<div class="alert alert-danger mb-4">
  <i class="ri-alert-line me-2"></i>{{.Error}}
</div>
{{end}}

<div class="card">
  {{if .SubscriptionOrders}}
  <div class="table-responsive">
    <table class="table table-hover align-middle mb-0">
      <thead class="bg-light">
        <tr>
          <th class="ps-4">订单</th>
          <th>套餐/组</th>
          <th>用户</th>
          <th>金额</th>
          <th>状态</th>
          <th>时间</th>
          <th class="text-end pe-4">操作</th>
        </tr>
      </thead>
      <tbody>
        {{range .SubscriptionOrders}}
        <tr>
          <td class="ps-4">
            <div class="font-monospace text-muted small">#{{.ID}}</div>
          </td>
          <td>
            <div class="fw-bold text-dark">{{.PlanName}}</div>
            {{if .GroupName}}<div><span class="badge bg-light text-secondary border fw-normal" style="font-size: 0.7rem;">{{.GroupName}}</span></div>{{end}}
          </td>
          <td class="text-muted small">{{.UserEmail}}</td>
          <td class="fw-bold text-dark">¥{{.AmountCNY}}</td>
          <td>
            {{if eq .Status 1}}
              <span class="badge rounded-pill bg-success bg-opacity-10 text-success px-2">
                <i class="ri-checkbox-circle-line me-1"></i>{{.StatusText}}
              </span>
            {{else if eq .Status 0}}
              <span class="badge rounded-pill bg-warning bg-opacity-10 text-warning px-2">
                <i class="ri-time-line me-1"></i>{{.StatusText}}
              </span>
            {{else}}
              <span class="badge rounded-pill bg-secondary bg-opacity-10 text-secondary px-2">
                <i class="ri-close-circle-line me-1"></i>{{.StatusText}}
              </span>
            {{end}}
          </td>
          <td class="text-muted small" style="line-height: 1.2;">
            <div title="创建时间">{{.CreatedAt}}</div>
            {{if .PaidAt}}<div class="text-success" title="支付时间"><i class="ri-bank-card-line me-1"></i>{{.PaidAt}}</div>{{end}}
            {{if .ApprovedAt}}<div class="text-primary" title="批准时间"><i class="ri-check-double-line me-1"></i>{{.ApprovedAt}}</div>{{end}}
          </td>
          <td class="text-end pe-4">
            <div class="d-inline-flex gap-1">
              <form method="POST" action="/admin/orders/{{.ID}}/approve" class="d-inline">
                <input type="hidden" name="_csrf" value="{{$.CSRFToken}}" />
                <button type="submit" class="btn btn-sm btn-light border text-success" title="批准生效" onclick="return confirm('确认批准并生效？该订单将被处理。');">
                  <i class="ri-checkbox-circle-line"></i>
                </button>
              </form>
              <form method="POST" action="/admin/orders/{{.ID}}/reject" class="d-inline">
                <input type="hidden" name="_csrf" value="{{$.CSRFToken}}" />
                <button type="submit" class="btn btn-sm btn-light border text-danger" title="不批准" onclick="return confirm('确认不批准？订单将不会生效。');">
                  <i class="ri-close-circle-line"></i>
                </button>
              </form>
            </div>
          </td>
        </tr>
        {{end}}
      </tbody>
    </table>
  </div>
  {{else}}
  <div class="text-center py-5 text-muted">
    <i class="ri-inbox-2-line fs-1 d-block mb-3"></i>
    暂无订单。
  </div>
  {{end}}
</div>
{{end}}
