{{define "admin_channel_detail"}}
<div class="d-flex justify-content-between align-items-center mb-4">
  <div>
    <div class="d-flex flex-wrap align-items-center gap-2 mb-2">
      <a href="/admin/channels" class="btn btn-sm btn-light border">
        <i class="ri-arrow-left-line me-1"></i>返回
      </a>
      <h2 class="h4 fw-bold mb-0">渠道详情</h2>
    </div>
    <div class="text-muted small">
      <span class="fw-semibold text-dark">{{.Channel.Name}}</span>
      <span class="mx-2 text-light">|</span>
      <span class="text-muted">#{{.Channel.ID}}</span>
      <span class="mx-2 text-light">|</span>
      <code class="bg-light border px-2 py-1 rounded" style="font-size: 0.75em;">{{.Channel.Type}}</code>
      {{if and (ne .Channel.Type "codex_oauth") .Endpoint.BaseURL}}
        <span class="mx-2 text-light">|</span>
        <code class="text-primary bg-light border px-2 py-1 rounded" style="font-size: 0.75em; max-width: 420px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">{{.Endpoint.BaseURL}}</code>
      {{end}}
    </div>
  </div>
</div>

<div class="card border-0 shadow-sm mb-4">
  <div class="card-body py-3 d-flex flex-wrap gap-2 align-items-center justify-content-between">
    <div class="d-flex flex-wrap gap-2 align-items-center">
      <span class="text-muted small">查询时间</span>
      <div class="btn-group" role="group" aria-label="window">
        <a href="/admin/channels/{{.Channel.ID}}/detail?window=5m" class="btn btn-sm {{if eq .ChannelUsageWindow "5m"}}btn-primary{{else}}btn-light border{{end}}">5m</a>
        <a href="/admin/channels/{{.Channel.ID}}/detail?window=1h" class="btn btn-sm {{if eq .ChannelUsageWindow "1h"}}btn-primary{{else}}btn-light border{{end}}">1h</a>
        <a href="/admin/channels/{{.Channel.ID}}/detail?window=24h" class="btn btn-sm {{if eq .ChannelUsageWindow "24h"}}btn-primary{{else}}btn-light border{{end}}">24h</a>
      </div>
      <span class="text-muted small ms-2">区间（{{.AdminTimeZoneEffective}}）：{{.ChannelUsageSince}} - {{.ChannelUsageUntil}}</span>
    </div>
  </div>
</div>

<div class="card border-0 shadow-sm overflow-hidden">
  <div class="bg-primary bg-opacity-10 py-3 px-4 d-flex justify-content-between align-items-center">
    <div>
      <span class="text-primary fw-bold text-uppercase small">{{if eq .Channel.Type "codex_oauth"}}账号用量{{else}}密钥用量{{end}}</span>
    </div>
  </div>
  <div class="table-responsive">
    <table class="table table-hover align-middle mb-0">
      <thead class="bg-light">
        <tr>
          <th style="width: 20%;">名称</th>
          <th style="width: 16%;">{{if eq .Channel.Type "codex_oauth"}}账号{{else}}Key{{end}}</th>
          <th class="text-end" style="width: 8%;">请求数</th>
          <th class="text-end" style="width: 10%;">成功/失败</th>
          <th class="text-end" style="width: 10%;">输入 Token</th>
          <th class="text-end" style="width: 10%;">输出 Token</th>
          <th style="width: 14%;">最近使用</th>
          <th style="width: 12%;">余额</th>
        </tr>
      </thead>
      <tbody>
        {{if .ChannelKeyUsage}}
          {{range .ChannelKeyUsage}}
          <tr>
            <td>
              <div class="d-flex flex-column">
                <span class="fw-semibold text-dark">{{.Name}}</span>
                <small class="text-muted">#{{.ID}}</small>
              </div>
            </td>
            <td>
              <code class="bg-light border px-2 py-1 rounded" style="font-size: 0.8em;">{{.Key}}</code>
            </td>
            <td class="text-end font-monospace fw-semibold text-dark">{{.Requests}}</td>
            <td class="text-end font-monospace">{{.Success}} / {{.Failure}}</td>
            <td class="text-end font-monospace">{{.InputTokens}}</td>
            <td class="text-end font-monospace">{{.OutputTokens}}</td>
            <td><span class="small text-muted">{{.LastSeen}}</span></td>
            <td><span class="small text-muted" title="{{.BalanceHint}}">{{.Balance}}</span></td>
          </tr>
          {{end}}
        {{else}}
          <tr>
            <td colspan="8" class="text-center text-muted py-3">暂无数据</td>
          </tr>
        {{end}}
      </tbody>
    </table>
  </div>
</div>
{{end}}

