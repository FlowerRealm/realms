{{define "page_oauth_consent"}}
<div class="row justify-content-center">
  <div class="col-md-8 col-lg-6">
    <div class="card  border-0 mt-5">
      <div class="card-body p-4">
        <h2 class="h5 mb-3">应用授权</h2>

        {{if .Error}}
        <div class="alert alert-danger py-2" role="alert">
          <span class="me-1 material-symbols-rounded">warning</span> {{.Error}}
        </div>
        {{end}}

        <p class="text-muted mb-3">
          应用 <strong>{{.OAuthAppName}}</strong> 请求访问你的 Realms 账号。
        </p>

        <div class="border rounded p-3 bg-light bg-opacity-10">
          <div class="mb-2">
            <div class="text-muted small mb-1">回调地址</div>
            <code class="user-select-all">{{.OAuthRedirectURI}}</code>
          </div>
          <div class="mb-0">
            <div class="text-muted small mb-1">权限</div>
            <div>获取 Realms API Token（`Authorization: Bearer rlm_...`），用于调用 `/v1/*`。</div>
            {{if .OAuthScope}}
            <div class="text-muted small mt-1">scope: <code class="user-select-all">{{.OAuthScope}}</code></div>
            {{end}}
          </div>
        </div>

        <form method="POST" action="/oauth/authorize" class="mt-3">
          <input type="hidden" name="_csrf" value="{{.CSRFToken}}">
          <input type="hidden" name="client_id" value="{{.OAuthClientID}}">
          <input type="hidden" name="redirect_uri" value="{{.OAuthRedirectURI}}">
          <input type="hidden" name="scope" value="{{.OAuthScope}}">
          <input type="hidden" name="state" value="{{.OAuthState}}">
          {{if .OAuthCodeChallenge}}<input type="hidden" name="code_challenge" value="{{.OAuthCodeChallenge}}">{{end}}
          {{if .OAuthCodeChallengeMethod}}<input type="hidden" name="code_challenge_method" value="{{.OAuthCodeChallengeMethod}}">{{end}}

          <div class="form-check mb-3">
            <input class="form-check-input" type="checkbox" id="oauthRemember" name="remember" value="1" checked>
            <label class="form-check-label" for="oauthRemember">记住本次授权（下次不再提示）</label>
          </div>

          <div class="d-flex gap-2">
            <button type="submit" name="decision" value="approve" class="btn btn-primary">同意并继续</button>
            <button type="submit" name="decision" value="deny" class="btn btn-outline-secondary">取消</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
{{end}}

