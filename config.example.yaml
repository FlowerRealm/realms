env: dev

self_mode:
  # 自用模式：禁用订阅/订单/充值/支付/工单等功能域，并放宽数据面配额策略（不再要求订阅已激活）。
  # 默认 false（保持现有行为不变）。
  enable: false

server:
  addr: ":8080"
  # 可选：用于生成页面中展示的外部访问地址（尤其是部署在反向代理/TLS 终止之后）。
  # 示例：https://realms.example.com
  # 也可在管理后台「系统设置」中配置 `site_base_url` 覆盖此值（优先）。
  public_base_url: ""
  read_header_timeout: 5s
  read_timeout: 30s
  write_timeout: 0s
  idle_timeout: 2m

db:
  # 示例：user:pass@tcp(127.0.0.1:3306)/realms?parseTime=true&charset=utf8mb4&collation=utf8mb4_unicode_ci
  dsn: "root:root@tcp(127.0.0.1:3306)/realms?parseTime=true&charset=utf8mb4&collation=utf8mb4_unicode_ci"

security:
  allow_open_registration: true
  disable_secure_cookies: true

  # 是否信任 X-Forwarded-* 头（用于在反向代理后正确展示 Base URL）。
  # 默认 false（更安全）。如需在反向代理/TLS 终止之后正确推断外部 Base URL，可开启并配置 trusted_proxy_cidrs 白名单。
  trust_proxy_headers: false
  # 可选：仅当请求来自这些 CIDR/IP 段时才信任 X-Forwarded-*（为空表示不信任任何来源）。
  # 如确实需要信任所有来源，请显式配置 0.0.0.0/0（IPv4）与 ::/0（IPv6）（不推荐）。
  trusted_proxy_cidrs: []
  # 可选：订阅订单“支付回调 webhook”鉴权密钥（HTTP Header：Authorization: Bearer <secret>）。
  # 为空表示禁用 webhook，避免未配置时被外部直接调用。
  subscription_order_webhook_secret: ""

limits:
  max_body_bytes: 4194304
  max_request_duration: 2m
  # 流式（SSE）请求最大持续时长；0 表示不限制（仍受 stream_idle_timeout 影响）。
  max_stream_duration: 30m
  max_inflight_per_token: 8
  max_sse_connections_per_token: 4
  max_inflight_per_credential: 16
  default_max_output_tokens: 1024
  # 上游 SSE 在长时间无输出时的中断阈值；0 表示不启用。
  stream_idle_timeout: 2m
  # 向下游发送 SSE ping（注释行）的间隔；0 表示不发送。
  sse_ping_interval: 0s
  # SSE 单行最大长度（字节）。过小会导致大事件行断流（默认 4MB）。
  sse_max_event_bytes: 4194304
  upstream_request_timeout: 2m
  upstream_dial_timeout: 10s
  upstream_tls_handshake_timeout: 10s
  upstream_response_header_timeout: 30s

debug:
  # 仅用于 dev 环境的排障日志（默认关闭）。建议不要在生产开启。
  proxy_log:
    enable: false
    dir: "./out/proxy"
    # 单条日志最大字节数（超过会截断长字段）。
    max_bytes: 131072
    # 最多保留文件数量（超出会删除最旧的文件）。
    max_files: 200

billing:
  # 是否启用“余额按量计费”（订阅额度不足/无订阅时，可使用余额扣费）。
  enable_pay_as_you_go: true
  # 最小充值金额（CNY，最多 2 位小数）。
  min_topup_cny: 10.00
  # 充值入账比例：每 1 CNY 增加多少 USD（最多 6 位小数）。
  credit_usd_per_cny: 0.14

payment:
  epay:
    enable: false
    # 易支付网关地址（由你的易支付服务提供方给出）。
    gateway: ""
    partner_id: ""
    key: ""
  stripe:
    enable: false
    secret_key: ""
    webhook_secret: ""
    currency: "cny"

codex_oauth:
  enable: true
  client_id: "app_EMoamEEZ73f0CkXaXp7hrann"
  authorize_url: "https://auth.openai.com/oauth/authorize"
  token_url: "https://auth.openai.com/oauth/token"
  # Codex OAuth 相关 HTTP 请求总超时（含 TLS 握手）。
  http_timeout: 2m
  # TLS 握手超时：网络较慢/代理较慢时可调大以避免 `net/http: TLS handshake timeout`。
  tls_handshake_timeout: 60s
  # Codex OAuth 请求是否直通上游：不改写 URL path 与请求体（默认 true）。
  # 适用于上游已能接受客户端原始 /v1/responses 形态的场景；如需旧版兼容改写逻辑可设为 false。
  request_passthrough: true
  # 说明：官方 Codex CLI 的 OAuth client_id 通常只允许 redirect_uri 为 localhost:1455。
  # 本配置默认使用 1455 作为 redirect_uri，但 callback_listen_addr 留空（不额外占用端口）：
  # - 浏览器回调会命中 http://localhost:1455/auth/callback（通常会连接失败）
  # - 这时请复制地址栏中的完整回调 URL（包含 code/state）并粘贴到管理后台完成授权
  #
  # 如需“自动回调”：
  # - 方式 A：把 server.addr 改成 :1455（全服务单端口运行）；或
  # - 方式 B：设置 callback_listen_addr=127.0.0.1:1455（会额外占用一个端口）。
  #
  # 如你使用自建 OAuth client_id 且允许自定义 redirect_uri，可把 redirect_uri 设为主服务端口的 /auth/callback，
  # 这样无需 callback_listen_addr 也能自动回调（单端口）。
  callback_listen_addr: ""
  redirect_uri: "http://localhost:1455/auth/callback"
  scope: "openid email profile offline_access"
  prompt: "login"

smtp:
  SMTPServer: "smtp.example.com"
  SMTPPort: 587
  SMTPSSLEnabled: false
  SMTPAccount: "noreply@example.com"
  SMTPFrom: "noreply@example.com"
  SMTPToken: "your_smtp_token"

email_verification:
  enable: false

tickets:
  # 工单附件本地存储目录（建议容器部署时挂载 volume 持久化）。
  attachments_dir: "./data/tickets"
  # 附件过期时间（默认 7 天）。
  attachment_ttl: 168h
  # 上传附件总大小限制（字节，不含 multipart 额外开销）。
  max_upload_bytes: 104857600

app_settings_defaults:
  # 管理后台「系统设置」（/admin/settings）存储在数据库表 app_settings。
  # 这里用于提供“配置文件默认值”，仅当数据库 app_settings 没有对应键时才会回退到这里。
  # 一旦在管理后台保存，会写入 app_settings 覆盖这里的默认值；点击「恢复为配置文件默认」会删除覆盖项。

  # 站点地址（对外可访问的基础地址），用于页面展示、支付回调/返回地址与 Codex OAuth 回跳链接生成。
  site_base_url: ""
  # 管理后台展示时间的时区（IANA TZ database name，如 Asia/Shanghai）。
  admin_time_zone: "Asia/Shanghai"

  # 功能禁用开关：true=禁用（隐藏入口，并对相关路由返回 404）。
  # 说明：
  # - feature_disable_billing=true：同时数据面进入 free mode（不校验订阅/余额；仍记录 usage_events）
  # - feature_disable_models=true：关闭 /models、/admin/models*、/v1/models，并使数据面进入模型穿透（model passthrough）
  feature_disable_web_announcements: false
  feature_disable_web_tokens: false
  feature_disable_web_usage: false
  feature_disable_models: false
  feature_disable_billing: false
  feature_disable_tickets: false
  feature_disable_admin_channels: false
  feature_disable_admin_channel_groups: false
  feature_disable_admin_users: false
  feature_disable_admin_usage: false
  feature_disable_admin_announcements: false
