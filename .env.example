# 复制一份作为 .env 使用（.env 已被 .gitignore 忽略，请不要提交真实口令/密钥）
#
# 用法（本地运行）：
#   cp .env.example .env
#   go run ./cmd/realms
#
# 用法（Docker compose）：
#   cp .env.example .env
#   docker compose pull realms
#   docker compose up -d

# MySQL（首次初始化生效；之后改密码需要自行处理用户/权限/数据）
MYSQL_ROOT_PASSWORD=root
MYSQL_DATABASE=realms
# docker compose MySQL 端口暴露（可选）
# - 默认对外监听：0.0.0.0:${MYSQL_HOST_PORT:-3306} -> 3306
# - 改端口示例：MYSQL_HOST_PORT=13306
# - 仅本机监听：MYSQL_BIND_IP=127.0.0.1
# MYSQL_HOST_PORT=3306
# MYSQL_BIND_IP=0.0.0.0

# Realms - 基础
REALMS_ENV=prod
REALMS_ADDR=":8080"
REALMS_PUBLIC_BASE_URL=""
# HTTP Server（连接硬化：10k-100k 连接场景建议设置）
# - WriteTimeout 保持为 0（不设置），避免影响 SSE 等长连接响应
REALMS_SERVER_READ_HEADER_TIMEOUT_SECONDS=5
REALMS_SERVER_READ_TIMEOUT_SECONDS=30
REALMS_SERVER_IDLE_TIMEOUT_SECONDS=120
REALMS_SERVER_MAX_HEADER_BYTES=1048576
# SSE（流式）安全上限：单行最大字节数（避免异常上游导致 OOM）；<=0 表示不限制
REALMS_SSE_MAX_LINE_BYTES=1048576
# Request body limits (for routes using BodyCache)
REALMS_PUBLIC_MAX_BODY_BYTES=1048576
REALMS_OPENAI_MAX_BODY_BYTES=8388608
# Upstream HTTP transport (pool & timeouts)
REALMS_UPSTREAM_HTTP_DIAL_TIMEOUT_SECONDS=30
REALMS_UPSTREAM_HTTP_TLS_HANDSHAKE_TIMEOUT_SECONDS=10
REALMS_UPSTREAM_HTTP_MAX_IDLE_CONNS=1024
REALMS_UPSTREAM_HTTP_MAX_IDLE_CONNS_PER_HOST=256
REALMS_UPSTREAM_HTTP_IDLE_CONN_TIMEOUT_SECONDS=90
# Data-plane auth cache (reduce DB QPS on TokenAuth hot path)
# - set to 0 to disable
REALMS_TOKEN_AUTH_CACHE_SIZE=50000
REALMS_TOKEN_AUTH_CACHE_TTL_MILLIS=2000
# Scheduler upstream snapshot cache（减少每请求读取 channels/endpoints/credentials 的 DB QPS）
# - 留空/<=0：禁用
# - 建议：1000–5000（配置变更频繁则设小一点）
# REALMS_UPSTREAM_SNAPSHOT_TTL_MILLIS=2000
# 多实例缓存失效轮询（DB version polling）
# - 留空：默认 1000ms
# - <=0：禁用（仅适合单实例）
# REALMS_CACHE_INVALIDATION_POLL_MILLIS=1000
# usage_events retention（可选：启用后会定期补算 rollup 并清理历史明细，控制表体积）
# - 留空/<=0：禁用（默认）
# - 建议：7–30 天（取决于审计/导出需求；统计请以 rollup 为准）
# REALMS_USAGE_EVENTS_RETENTION_DAYS=30
# usage rollup 分片（降低 hour rollup 的并发 upsert 热点）
# - 注意：必须同时设置 shards 与 cutover 才会启用（多实例需一致）
# REALMS_USAGE_ROLLUP_SHARDS=16
# REALMS_USAGE_ROLLUP_SHARDS_CUTOVER_AT=2026-02-15T00:00:00Z
# Cookie session（前端登录态）
# - 未设置时运行期随机生成（重启会导致会话失效），生产环境请务必设置为随机字符串
SESSION_SECRET=

# Frontend（前后端分离 / SPA）
# - 同源部署：后端会从 FRONTEND_DIST_DIR 提供静态资源（默认 ./web/dist），并对 /login 等路径回落到 index.html
FRONTEND_DIST_DIR=./web/dist
# - 外置前端：设置后，后端会把“非 API”路径 301 跳转到该 base URL（类似 new-api 的 FRONTEND_BASE_URL）
FRONTEND_BASE_URL=
# Docker compose 镜像（可选：固定版本/私有仓库/本地构建镜像）
# - 默认使用 Docker Hub: flowerrealm/realms
# - 固定版本示例: flowerrealm/realms:v1.2.3
# - 后端专用镜像（前后端分离部署）: flowerrealm/realms:backend 或 flowerrealm/realms:v1.2.3-backend
# - 本地构建示例: flowerrealm/realms:local
# REALMS_IMAGE=flowerrealm/realms
# 数据库 DSN：
# - 本地运行（go run / air）：使用 127.0.0.1（无论 MySQL 是本机进程还是 docker 容器映射端口）
# - Docker compose（realms 容器内）：默认使用 mysql:3306（见下方 REALMS_DB_DSN_DOCKER）
REALMS_DB_DSN="root:root@tcp(127.0.0.1:3306)/realms?parseTime=true&charset=utf8mb4&collation=utf8mb4_unicode_ci&time_zone=%27%2B00%3A00%27"
# 可选：仅用于 docker compose 中 realms 容器的 DSN 覆盖（不影响本地 go run）
REALMS_DB_DSN_DOCKER="root:root@tcp(mysql:3306)/realms?parseTime=true&charset=utf8mb4&collation=utf8mb4_unicode_ci&time_zone=%27%2B00%3A00%27"
# SQLite（可选）
# - 默认：REALMS_DB_DSN 为空时自动使用 SQLite（文件：./data/realms.db?_busy_timeout=30000）
# - 如需显式指定：REALMS_DB_DRIVER=sqlite
# - 如需修改路径：REALMS_SQLITE_PATH=./data/realms.db?_busy_timeout=30000
# REALMS_DB_DRIVER=sqlite
# REALMS_SQLITE_PATH=./data/realms.db?_busy_timeout=30000

# 初次部署建议临时允许注册：第一个注册用户会成为 root；完成初始化后建议改为 false
REALMS_ALLOW_OPEN_REGISTRATION=true

# 无 TLS/反向代理的纯 HTTP 场景：需要允许非 Secure Cookie，否则 Web 登录会不可用
REALMS_DISABLE_SECURE_COOKIES=true

# 反向代理 / TLS 终止（可选）
REALMS_TRUST_PROXY_HEADERS=false
REALMS_TRUSTED_PROXY_CIDRS=
REALMS_SUBSCRIPTION_ORDER_WEBHOOK_SECRET=

# 自用模式（可选）
REALMS_SELF_MODE_ENABLE=false

# Debug（仅 dev 环境可用）
REALMS_DEBUG_PROXY_LOG_ENABLE=false
REALMS_DEBUG_PROXY_LOG_DIR=./out/proxy
# Debug routes（显式开启才暴露；请勿对公网开放）
# - /debug/vars  (expvar：active_sse_connections 等)
# - /debug/pprof (pprof：heap/goroutine/profile 等)
# REALMS_DEBUG_ROUTES=1
# Debug routes 访问控制（可选）
# - 默认仅允许本机（127.0.0.1/::1）
# - 额外允许的来源 CIDR（逗号分隔）
# REALMS_DEBUG_ROUTES_ALLOW_CIDRS=10.0.0.0/8
# - 允许通过令牌访问（header: X-Realms-Debug-Token）
# REALMS_DEBUG_ROUTES_TOKEN=

# Billing（可选）
REALMS_BILLING_ENABLE_PAY_AS_YOU_GO=true
REALMS_BILLING_MIN_TOPUP_CNY=10.00
REALMS_BILLING_CREDIT_USD_PER_CNY=0.14

# Payment（说明）
# 支付渠道已迁移到数据库配置：请在「管理后台 → 支付渠道」创建/启用渠道。

# SMTP（可选）
REALMS_SMTP_SERVER=smtp.example.com
REALMS_SMTP_PORT=587
REALMS_SMTP_SSL_ENABLED=false
REALMS_SMTP_ACCOUNT=noreply@example.com
REALMS_SMTP_FROM=noreply@example.com
REALMS_SMTP_TOKEN=

# Email verification（可选）
REALMS_EMAIL_VERIFICATION_ENABLE=false

# Tickets（可选）
REALMS_TICKETS_ATTACHMENTS_DIR=./data/tickets

# App settings defaults（仅当数据库中没有对应 app_settings 时生效）
REALMS_APP_SETTINGS_DEFAULTS_SITE_BASE_URL=
REALMS_APP_SETTINGS_DEFAULTS_ADMIN_TIME_ZONE=Asia/Shanghai
REALMS_APP_SETTINGS_DEFAULTS_FEATURE_DISABLE_WEB_ANNOUNCEMENTS=false
REALMS_APP_SETTINGS_DEFAULTS_FEATURE_DISABLE_WEB_TOKENS=false
REALMS_APP_SETTINGS_DEFAULTS_FEATURE_DISABLE_WEB_USAGE=false
REALMS_APP_SETTINGS_DEFAULTS_FEATURE_DISABLE_MODELS=false
REALMS_APP_SETTINGS_DEFAULTS_FEATURE_DISABLE_BILLING=false
REALMS_APP_SETTINGS_DEFAULTS_FEATURE_DISABLE_TICKETS=false
REALMS_APP_SETTINGS_DEFAULTS_FEATURE_DISABLE_ADMIN_CHANNELS=false
REALMS_APP_SETTINGS_DEFAULTS_FEATURE_DISABLE_ADMIN_CHANNEL_GROUPS=false
REALMS_APP_SETTINGS_DEFAULTS_FEATURE_DISABLE_ADMIN_USERS=false
REALMS_APP_SETTINGS_DEFAULTS_FEATURE_DISABLE_ADMIN_USAGE=false
REALMS_APP_SETTINGS_DEFAULTS_FEATURE_DISABLE_ADMIN_ANNOUNCEMENTS=false

# 可选：Docker 构建 tags（例如 no_webchat）
REALMS_BUILD_TAGS=
